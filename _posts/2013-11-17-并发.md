---
layout: post
title: 并发
tags: 并发
categories: Java
---

# 并发
## 锁
锁提供了两种主要特性：互斥（mutual exclusion） 和可见性（visibility）

可见性，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 

Volatile 变量具有 synchronized 的可见性特性，但是不具备原子特性

使用 volatile 的限制： 只有在状态真正独立于程序内其他内容时才能使用 volatile 

```
  class Test {
        private volatile Instance instance = null;
        public Instance getInstance() {
            if (instance == null) {
                synchronized(this) {
                    if (instance == null)
                        instance = new Instance();
                }
            }
            return instance;
        }
    }
```
问题描述：使用synchronized关键字双层检测时，instance对象初始化时，由于指令重排序，但是instance还未初始化完成，但是instance已经为非null    
解决方法：通过加volatile关键字，禁止指令重排序
参考：http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html
